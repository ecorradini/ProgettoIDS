IOT FOR EMERGENCY MANAGEMENT


1. CARATTERI GENERALI

Il progretto prevede lo sviluppo di un sistema in grado di rilevare e segnalare le emergenze che possono verificarsi all'interno di un edificio. La piattaforma si basa su un server centrale di elaborazione dei dati, sensori e attuatori. I sensori sono i beacon installati all'interno dei vari ambienti degli edifici gestiti; gli attuatori sono segnali di tipo luminoso e acustico, il cui scopo principale è quello di segnalare emergenze e fornire informazioni ai soccorritori, e i dispositivi mobile per mostrare le via di fuga.
L'applicazione può funzionare in due diverse modalità: una ordinaria, che permette ad un utente di conoscere la sua posizione e dirigerlo verso una destinazione qualsiasi all'interno dell'edificio, e una di emergenza, che, rilevato un evento che richiede l'evacuazione dell'edificio, viene automaticamente attivata (all'occorrenza anche manualmente) e nella quale viene mostrata la via di fuga più veloce e sicura. L'applicazione può funzionare in modalità online o offline (grazie ad un database lato client). 


2. COMPONENTI 

2.1. Beacon

I beacon hanno la funzione di rilevare dati ambientali (quali temperatura, presenza di gas, cedimenti di strutture...) e trasmetterli al sistema (FUNZIONALITÀ DI CUI NON DOBBIAMO TENERE CONTO). La loro funzione principale è quella di "geotag": agganciandosi tramite Bluetooth al beacon più vicino, un utente può conoscere la sua posizione all'interno di un piano dell'edificio in questione, allo stesso modo, il sistema conosce il numero di persone presenti in un determinato ambiente (dato importante per il calcolo del percorso di fuga in modo tale da rendere l'evacuazione sicura, evitando congestioni).

2.2. Server

IN BASE A QUELLO CHE DOBBIAMO FARE NOI, lo scopo principale del server è quello di comunicare con i dispositivi mobile degli utenti e calcolare il percorso di fuga migliore nel caso in cui si verifichino delle emergenze. L'emergenza viene segnalata dagli utenti stessi (E NON TRAMITE SENSORI, PER ORA...): una volta che il server rileva una segnalazione nel suo database, viene avviata la modalità di emergenza.  
  
2.3. Applicazione mobile

L'app mobile deve permettere agli utenti di registrarsi e successivamente autenticarsi per accedere alle funzionalità della piattaforma. L'utente registrato e autenticato è in grado di vedere la propria posizione sulla piantina del piano in cui si trova. In modalità ordinaria può inserire e quindi richiedere il percorso per raggiungere una certa destinazione, modificare i dati inseriti nella fase di registrazione (PER ORA ABBIAMO PREVISTO SOLO LA PASSWORD). Nel caso in cui ci sia un'emergenza, viene ricevuta una notifica push che segnala l'evento e accedendo all'app, che si trova in modalità di emergenza, viene visualizzato il percorso migliore per evacuare l'edificio. Il rientro dell'emergenza o l'avvenuta evacuazione viene segnalata con una seconda notifica push.


3. FUNZIONAMENTO

Partiamo dal presupposto che il database è già popolato con le mappe dei piani degli edifici gestiti, le coordinate di inizio e fine dei tronchi, nonché la loro larghezza (SARÀ POI UTILE PER IL CALCOLO DEL LOS), coordinate dei beacons presenti all'interno di ciascun tronco. Un utente al primo avvio dell'app si deve registrare inserendo i suoi dati (nome, cognome, email/username, password. Quest'ultima viene crittata.): una volta inviati al server, esso provvede a salvarli nel database locale. Una volta registrato può effettuare il login con le sue credenziali: inviati al server email/username e password, viene verificato il matching tra i dati ricevuti e quelli presenti nel db, quindi concede o non concede l'accesso all'app. 
Al primo avvio, alcune delle informazioni presenti nel database remoto vengono copiate in un database locale. Se non attivo, viene mostrata un avviso in cui si chiede di attivare il Bluetooth per connettersi al beacon più vicino. Una volta avvenuta la connessione con il beacon, l'app invia al server l'ID del beacon al quale è agganciato, il server aggiorna il database e restituisce la mappa(in base64) del piano in cui si trova l'utente con la segnalazione della posizione (coordinate del beacon all'interno del tronco e quindi della mappa). Lato client, la mappa verrà convertita in bitmap e visualizzata sulla schermata principale, con la possibilità di essere ingrandita. 
Grazie al suppporto del db locale, deve essere possibile calcolare il percorso verso una destinazione qualsiasi all'interno dell'edificio, nonché il percorso migliore (dal punto di vista dell'algoritmo) verso la via d'uscita più vicina in modalità offline (il percorso potrebbe essere calcolato su un set di dati non aggioranti con quelli presenti nel db remoto). Il calcolo del percorso deve avvenire ogni volta che l'utente transita da un tronco ad uno adiacente. Nel caso in cui il database subisca delle modifiche, il server invia un messaggio in broadcast per segnalare tali modifiche ai dispositivi mobile, i quali sono in ascolto tramite un BackgroundService, che provvederanno ad aggiornare il server locale.
Nella modalità ordinaria, l'utente ha la possibilità di modificare la password: inizialmente viene richiesta la vecchia password, quindi si inserisce una nuova password e la sua conferma. Inviati i dati al server, verrà aggiornato il db (in questo caso non c'è bisogno di inviare il messaggio in broadcast). Ogni volta che l'utente si sposta e si aggancia ad un nuovo beacon, la modifica deve essere notificata al server il quale provvederà all'aggiornamento del db, al calcolo della nuova posizione e quindi alla restituzione della nuova posizione sulla mappa.
Se il server rivela una segnalazione di emergenza nel db, il server invia  tutti gli utenti online una notifica push che segnala l'evento: si apre l'app in modalità di emergenza e viene mostrata la mappa con il percorso migliore calcolato. Il percorso deve essere ricalcolato ogni volta che l'utente transita da un tronco all'altro o se variano le condizioni dell'edificio. Ogni volta che il dispositivo mobile si aggancia ad un nuovo beacon viene inviato l'ID del nuovo beacon al server. Quando rientra l'emergenza o l'utente si è agganciato al beacon prossimo all'uscita, il server invia una notifica push per segnalare la fine dell'emergenza. Si ripristina la modalità ordinaria.
